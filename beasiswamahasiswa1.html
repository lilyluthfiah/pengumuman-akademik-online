<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PAO-POLIBATAM - Beasiswa (Mahasiswa)</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
/* Reset & Layout Dasar */
* { margin:0; padding:0; box-sizing:border-box; }
html,body{height:100%; display:flex; flex-direction:column; background:url('polibatam.jpg') center/cover no-repeat fixed; font-family:'Poppins',sans-serif; color:#333;}

/* Header */
.header{background-color:#D5CDB9; padding:15px 30px; display:flex; align-items:center; justify-content:space-between; color:black; position:sticky; top:0; z-index:100; box-shadow:0 2px 5px rgba(0,0,0,0.1);}

/* Sidebar */
.sidebar{width:220px; background:linear-gradient(180deg,#ffffff 0%,#e9f1ff 100%); min-height:calc(100vh - 60px); border-right:2px solid #d1e0ff; box-shadow:2px 0 8px rgba(0,0,0,0.05); position:relative; z-index:10; transition:all 0.3s ease; padding:15px;}
.sidebar .nav-link{color:#333; font-size:15px; font-weight:500; padding:10px 15px; border-radius:8px; margin-bottom:8px; display:flex; align-items:center; gap:10px; transition:0.3s;}
.sidebar .nav-link i{font-size:18px; color:#007bff; transition:0.3s;}
.sidebar .nav-link:hover{background-color:#e3efff; transform:translateX(4px);}
.sidebar .nav-link.active{background:linear-gradient(to right,#007bff,#00c4ff); color:white !important; font-weight:600;}
.sidebar .nav-link.active i{color:white;}

/* Konten & Footer */
.content{flex-grow:1; padding:20px; display:flex; flex-direction:column;}
.footer{background-color:#D5CDB9; color:white; padding:10px 0; text-align:center; margin-top:auto;}
button{cursor:pointer;}

/* Modal */
.modal {display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color: rgba(0,0,0,0.5);}
.modal-content {background-color:#fff; margin:5% auto; padding:20px; border-radius:10px; width:90%; max-width:600px;}
.close {float:right; font-size:28px; font-weight:bold; text-decoration:none; color:#000;}
.close:hover {color:#dc3545; text-decoration:none;}
table td input[type="file"]{width:100%;}

/* Notifikasi popup */
.notification-popup {position:absolute; top:40px; right:0; background:#fff; border:1px solid #ccc; border-radius:8px; padding:10px; width:250px; display:none; z-index:200; box-shadow:0 2px 8px rgba(0,0,0,0.15);}
.notification-popup.show {display:block;}
</style>
</head>
<body>

<!-- Header -->
<header class="header d-flex justify-content-between align-items-center px-4">
  <div>
    <h4 class="fw-bold mb-0">Halo Mahasiswa,</h4>
    <h5 class="fw-bold">SELAMAT DATANG DI PAO-POLIBATAM</h5>
  </div>
  <div class="d-flex align-items-center gap-3 position-relative">
    <i class="bi bi-bell fs-3 text-dark" id="notifIcon" title="Notifikasi"></i>
    <div class="notification-popup" id="notifPopup">
      <h6 class="fw-bold mb-2">ðŸ“¢ Notifikasi</h6>
      <div id="notifPopupContent"><p class="text-muted small mb-0">Belum ada notifikasi.</p></div>
    </div>
    <i class="bi bi-person-circle fs-3 text-dark profile-icon" title="Profile"></i>
    <i class="bi bi-box-arrow-right fs-3 text-dark logout-btn" title="Logout"></i>
  </div>
</header>

<!-- Sidebar & Konten -->
<div class="d-flex flex-grow-1">
  <aside class="sidebar">
    <ul class="nav flex-column">
      <li class="nav-item"><a class="nav-link" href="#">Pengumuman</a></li>
      <li class="nav-item"><a class="nav-link" href="#">Jadwal Ujian</a></li>
      <li class="nav-item"><a class="nav-link" href="#">Jadwal Kuliah</a></li>
      <li class="nav-item"><a class="nav-link active" href="#">Beasiswa</a></li>
    </ul>
  </aside>

  <main class="content">
    <!-- Beasiswa tersedia -->
    <h3 class="mb-3 text-center btn btn-secondary">Beasiswa Tersedia</h3>
    <table class="table table-bordered align-middle text-center" id="tabelBeasiswaMahasiswa">
      <thead><tr><th>No</th><th>Nama Beasiswa</th><th>Deskripsi</th><th>Syarat</th><th>Aksi</th></tr></thead>
      <tbody></tbody>
    </table>

    <!-- Beasiswa terdaftar -->
    <h3 class="mt-5 mb-3 text-center btn btn-secondary">Beasiswa Terdaftar</h3>
    <table class="table table-bordered align-middle text-center" id="tabelDaftarMahasiswa">
      <thead><tr><th>No</th><th>Nama Beasiswa</th><th>Jurusan/Prodi</th><th>Status</th><th>File Pendukung</th><th>File Syarat</th></tr></thead>
      <tbody></tbody>
    </table>
  </main>
</div>

<!-- Footer -->
<footer class="footer text-center text-white py-2">
  Â© 2025 Sistem Informasi Akademik - POLIBATAM |
  <a href="#" class="text-warning text-decoration-none">Kebijakan Privasi</a> |
  <a href="#" class="text-warning text-decoration-none">Kontak</a>
</footer>

<!-- Modal Daftar Beasiswa -->
<div class="modal" id="modalDaftar">
  <div class="modal-content">
    <a href="#" class="close" onclick="closeModal()">&times;</a>
    <h5 class="mb-3">Form Daftar Beasiswa</h5>
    <form id="formDaftarBeasiswa">
      <div class="mb-3"><label>Nama Lengkap</label><input type="text" class="form-control" name="nama" required></div>
      <div class="mb-3"><label>NIM</label><input type="text" class="form-control" name="nim" required></div>
      <div class="mb-3"><label>Jurusan / Prodi</label><input type="text" class="form-control" name="prodi" required></div>
      <div class="mb-3">
        <label>Upload Dokumen Pendukung</label>
        <input type="file" class="form-control" name="pendukung" multiple required>
        <small class="text-muted">Unggah dokumen sesuai syarat beasiswa, bisa lebih dari satu file.</small>
      </div>
      <div id="syaratFilesContainer" class="mb-3"></div>
      <input type="hidden" name="indexBeasiswa">
      <div class="d-flex gap-2">
        <button type="button" class="btn btn-secondary flex-fill" onclick="previewFiles()">Preview</button>
        <button type="submit" class="btn btn-success flex-fill">Submit</button>
      </div>
      <div id="previewContainer" class="mt-2"></div>
    </form>
  </div>
</div>

<script>
// Logout & Profile
document.querySelector(".logout-btn").addEventListener("click",()=>{alert("Berhasil logout!");window.location.href="login.html";});
document.querySelector(".profile-icon").addEventListener("click",()=>{window.location.href="profile.html";});

// Notifikasi
const notifIcon = document.getElementById("notifIcon");
const notifPopup = document.getElementById("notifPopup");
const notifPopupContent = document.getElementById("notifPopupContent");
notifIcon.addEventListener("click", () => {
  notifPopup.classList.toggle("show");
  const notifText = localStorage.getItem("latestNotification");
  notifPopupContent.innerHTML = notifText ? `<div class="alert alert-info py-2 mb-0 text-start">${notifText}</div>` :
    `<p class="text-muted small mb-0">Belum ada notifikasi.</p>`;
});
document.addEventListener("click",(e)=>{ if(!notifPopup.contains(e.target) && !notifIcon.contains(e.target)) notifPopup.classList.remove("show"); });

// Load Beasiswa Mahasiswa
function loadBeasiswaMahasiswa() {
  const beasiswa = JSON.parse(localStorage.getItem("beasiswaList")||"[]");
  const tabel = document.querySelector("#tabelBeasiswaMahasiswa tbody");
  tabel.innerHTML = "";
  beasiswa.forEach((b,i)=>{
    const row=document.createElement("tr");
    const syaratList = b.syaratFiles ? b.syaratFiles.join(", ") : "-";
    row.innerHTML=`<td>${i+1}</td><td>${b.nama}</td><td>${b.deskripsi}</td><td>${syaratList}</td>
      <td><button class="btn btn-success btn-sm" onclick="openDaftarModal(${i})">Daftar</button></td>`;
    tabel.appendChild(row);
  });
}

// Load daftar mahasiswa
function loadDaftarMahasiswa() {
  const daftar = JSON.parse(localStorage.getItem("pendaftarList")||"[]");
  const tabel = document.querySelector("#tabelDaftarMahasiswa tbody");
  tabel.innerHTML = "";
  daftar.forEach((d,i)=>{
    const pendukung = d.pendukung ? d.pendukung.join(", ") : "-";
    const syarat = d.syarat ? d.syarat.join(", ") : "-";
    const row=document.createElement("tr");
    row.innerHTML=`<td>${i+1}</td><td>${d.beasiswa}</td><td>${d.prodi}</td><td>${d.status}</td><td>${pendukung}</td><td>${syarat}</td>`;
    tabel.appendChild(row);
  });
}

// Modal daftar
function openDaftarModal(index){
  const beasiswaList = JSON.parse(localStorage.getItem("beasiswaList")||"[]");
  const b = beasiswaList[index];
  const container = document.getElementById("syaratFilesContainer");
  container.innerHTML = '';
  if(b.syaratFiles && b.syaratFiles.length>0){
    b.syaratFiles.forEach((f,i)=>{
      const div = document.createElement("div");
      div.classList.add("mb-2");
      div.innerHTML = `<label>${f}</label><input type="file" class="form-control" name="file${i}" required>`;
      container.appendChild(div);
    });
  }
  document.getElementById("formDaftarBeasiswa").reset();
  document.querySelector("#formDaftarBeasiswa input[name='indexBeasiswa']").value = index;
  document.getElementById("previewContainer").innerHTML = '';
  document.getElementById("modalDaftar").style.display = "block";
}

function closeModal(){ document.getElementById("modalDaftar").style.display = "none"; }

// Preview file
function previewFiles(){
  const form = document.getElementById("formDaftarBeasiswa");
  const pendukung = Array.from(form.pendukung.files).map(f => f.name);
  const syaratInputs = Array.from(form.querySelectorAll("[name^='file']"));
  const syaratFiles = syaratInputs.map(inp => inp.files[0] ? inp.files[0].name : "Belum pilih file");
  document.getElementById("previewContainer").innerHTML = `<b>Dokumen Pendukung:</b> ${pendukung.join(", ")}<br>
    <b>Dokumen Syarat:</b> ${syaratFiles.join(", ")}`;
}

// Submit form daftar
document.getElementById("formDaftarBeasiswa").addEventListener("submit",function(e){
  e.preventDefault();
  const nama = this.nama.value, nim = this.nim.value, prodi = this.prodi.value;
  const pendukungFiles = Array.from(this.pendukung.files).map(f => f.name);
  if(pendukungFiles.length===0){ alert("Harap unggah minimal satu dokumen pendukung!"); return; }

  const index = parseInt(this.indexBeasiswa.value);
  const beasiswaList = JSON.parse(localStorage.getItem("beasiswaList")||"[]");
  const b = beasiswaList[index];

  const filesSyarat = [];
  for(let i=0;i<(b.syaratFiles?b.syaratFiles.length:0);i++){
    const fileInput = this[`file${i}`];
    if(fileInput.files.length===0){ alert("Semua file syarat harus diunggah!"); return; }
    filesSyarat.push(fileInput.files[0].name);
  }

  const pendaftar = JSON.parse(localStorage.getItem("pendaftarList")||"[]");
  pendaftar.push({nama, nim, prodi, beasiswa: b.nama, status: "Proses", keterangan: "", pendukung: pendukungFiles, syarat: filesSyarat});
  localStorage.setItem("pendaftarList",JSON.stringify(pendaftar));
  alert("Berhasil submit & mengunggah file!");
  closeModal();
  loadDaftarMahasiswa();
});

// Initialize
loadBeasiswaMahasiswa();
loadDaftarMahasiswa();
</script>

</body>
</html>
